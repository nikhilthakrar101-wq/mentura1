<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard | Mentura</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root{
      --bg:#111827; --card:#1f2933; --text:#fff; --muted:#9ca3af; --border:rgba(255,255,255,.10);
    }
    body{
      margin:0; font-family:"Segoe UI", Arial, sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .box{
      width:100%; max-width:520px; background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:40px 28px; text-align:center;
    }
    h1{ margin:0 0 10px 0; font-size:26px; }
    p{ margin:0; color:var(--muted); line-height:1.6; }
    .small{ margin-top:14px; font-size:13px; color:var(--muted); }
    a{ color:#fff; text-decoration:underline; text-underline-offset:3px; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://kdilnufycjzckxsqawud.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtkaWxudWZ5Y2p6Y2t4c3Fhd3VkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTIzNTEsImV4cCI6MjA4MTM4ODM1MX0.c7iGfGWsGEmINWbvpoJk22fkE8c8DdsKHaEpX4tLRPw"; // usually starts with eyJ...
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function routeDashboard() {
      try {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (!session?.user) {
          // not logged in
          window.location.href = "/create-account.html";
          return;
        }

        const userId = session.user.id;

        const { data: profile, error } = await supabaseClient
          .from("profiles")
          .select("plan,status")
          .eq("user_id", userId)
          .maybeSingle();

        // If your RLS blocks this select, you'll end up here:
        if (error) {
          console.error(error);
          // Fallback: send to free dashboard
          window.location.href = "/dashboard-free.html";
          return;
        }

        // If no profile row exists yet, treat as Free
        if (!profile) {
          window.location.href = "/dashboard-free.html";
          return;
        }

        // Plus users must be active to see plus dashboard
        if (profile.plan === "plus" && profile.status === "active") {
          window.location.href = "/dashboard-plus.html";
          return;
        }

        // Anything else (free, pending, canceled) -> free dashboard
        window.location.href = "/dashboard-free.html";
      } catch (e) {
        console.error(e);
        window.location.href = "/dashboard-free.html";
      }
    }

    window.addEventListener("DOMContentLoaded", routeDashboard);
  </script>
</head>
<body>
  <div class="box">
    <h1>Loading your dashboard…</h1>
    <p>Hang tight — we’re checking your membership.</p>
    <div class="small">
      Need help? <a href="mailto:menturacontact@gmail.com">menturacontact@gmail.com</a>
    </div>
  </div>
</body>
</html>

