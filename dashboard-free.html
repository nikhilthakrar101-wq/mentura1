<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard (Free) | Mentura</title>

  <style>
    :root{
      --bg:#111827; --card:#1f2933; --text:#fff; --muted:#9ca3af;
      --border:rgba(255,255,255,.10); --green:#4ade80;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:"Segoe UI", Arial, sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{ width:100%; max-width:820px; }
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:34px 26px;
    }
    h1{ margin:0 0 8px 0; font-size:28px; }
    p{ margin:0 0 18px 0; color:var(--muted); line-height:1.65; }
    .topbar{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      margin-bottom:18px; flex-wrap:wrap;
    }
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid var(--border);
      color:var(--muted); font-weight:700; font-size:13px;
    }
    .pill b{ color:var(--text); }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; }

    a.linkbtn, button.linkbtn{
      display:inline-block; padding:10px 14px; border-radius:10px;
      background:#ffffff; color:#111827; text-decoration:none; font-weight:800;
      letter-spacing:.03em; border:none; cursor:pointer;
    }
    a.ghost, button.ghost{
      background:transparent; color:var(--text);
      border:1px solid var(--border);
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }

    .form{
      margin-top:18px;
      padding:18px;
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      background:rgba(17,24,39,.35);
    }

    label{ display:block; font-weight:700; margin-bottom:8px; }
    input[type="email"]{
      width:100%;
      padding:14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:#111827;
      color:#fff;
      outline:none;
      margin-bottom:14px;
    }
    input[type="email"]::placeholder{ color:var(--muted); }

    .choices{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 860px){ .choices{ grid-template-columns:1fr; } }

    .choice{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:12px;
      padding:16px;
      cursor:pointer;
      transition:.18s ease;
      position:relative;
      min-height:72px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .choice:hover{ transform:translateY(-1px); border-color:rgba(255,255,255,.18); }
    .choice.active{
      border-color:rgba(74,222,128,.55);
      background:rgba(74,222,128,.08);
    }
    .choice-title{ font-weight:800; letter-spacing:-0.01em; }
    .choice-sub{ color:var(--muted); font-size:13px; margin-top:6px; line-height:1.45; }

    .radio{
      appearance:none;
      width:18px;
      height:18px;
      border-radius:999px;
      border:2px solid rgba(255,255,255,.28);
      display:inline-block;
      position:relative;
      flex:0 0 auto;
    }
    .choice.active .radio{ border-color:rgba(74,222,128,.9); }
    .choice.active .radio::after{
      content:"";
      position:absolute;
      inset:3px;
      background:var(--green);
      border-radius:999px;
    }

    .hidden{ display:none; }
    .submitRow{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .note{
      margin-top:14px;
      color:var(--muted);
      font-size:14px;
      line-height:1.55;
    }
    .note a{ color:#fff; text-decoration:underline; text-underline-offset:3px; }
  </style>

  <!-- SUPABASE (for upgrade button session) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://kdilnufycjzckxsqawud.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtkaWxudWZ5Y2p6Y2t4c3Fhd3VkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTIzNTEsImV4cCI6MjA4MTM4ODM1MX0.c7iGfGWsGEmINWbvpoJk22fkE8c8DdsKHaEpX4tLRPw"; // <-- paste the eyJ... key here
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="pill">Plan: <b>Free</b></div>
        <div class="actions">
          <a class="linkbtn ghost" href="mailto:menturacontact@gmail.com">Contact us</a>
          <button id="upgradeBtn" class="linkbtn" type="button">Upgrade to Plus</button>
        </div>
      </div>

      <h1>Choose your newsletter</h1>
      <p>Pick exactly one option below and we’ll email it to you each week.</p>

      <div class="form">
        <!-- No action/method here. We'll submit via fetch() so we control redirect -->
        <form id="newsletter-form">
          <label for="email">Your email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />

          <input type="hidden" name="_subject" value="Mentura Free Newsletter Signup" />

          <!-- Only one option -->
          <input class="hidden" type="radio" name="newsletter" id="econ" value="Economics Breakdown of the week" required />
          <input class="hidden" type="radio" name="newsletter" id="market" value="Market Breakdown of the week" required />
          <input class="hidden" type="radio" name="newsletter" id="deal" value="Deal of the week" required />

          <div class="choices" style="margin-top:10px;">
            <div class="choice" data-target="econ" tabindex="0" role="button" aria-label="Choose Economics Breakdown of the week">
              <div>
                <div class="choice-title">Economics Breakdown of the week</div>
                <div class="choice-sub">Short, clear summaries of the most important economics topics.</div>
              </div>
              <span class="radio" aria-hidden="true"></span>
            </div>

            <div class="choice" data-target="market" tabindex="0" role="button" aria-label="Choose Market Breakdown of the week">
              <div>
                <div class="choice-title">Market Breakdown of the week</div>
                <div class="choice-sub">What moved the markets and why — explained simply.</div>
              </div>
              <span class="radio" aria-hidden="true"></span>
            </div>

            <div class="choice" data-target="deal" tabindex="0" role="button" aria-label="Choose Deal of the week">
              <div>
                <div class="choice-title">Deal of the week</div>
                <div class="choice-sub">One standout deal and the key takeaways.</div>
              </div>
              <span class="radio" aria-hidden="true"></span>
            </div>
          </div>

          <div class="submitRow">
            <button id="submitBtn" class="linkbtn" type="submit">Subscribe</button>
            <a class="linkbtn ghost" href="/index.html">Back to Mentura</a>
          </div>

          <div class="note">
            Questions? Email us at <a href="mailto:menturacontact@gmail.com">menturacontact@gmail.com</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Newsletter choice UI
    const choices = Array.from(document.querySelectorAll(".choice"));
    function setActive(targetId) {
      choices.forEach(c => c.classList.toggle("active", c.dataset.target === targetId));
      const input = document.getElementById(targetId);
      if (input) input.checked = true;
    }
    choices.forEach(choice => {
      const pick = () => setActive(choice.dataset.target);
      choice.addEventListener("click", pick);
      choice.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); pick(); }
      });
    });

    // Submit newsletter to Formspree via fetch(), then redirect to YOUR page
    const FORM_ENDPOINT = "https://formspree.io/f/maqnozeg";
    const newsletterForm = document.getElementById("newsletter-form");
    const submitBtn = document.getElementById("submitBtn");

    newsletterForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      submitBtn.disabled = true;
      const oldText = submitBtn.textContent;
      submitBtn.textContent = "Sending…";

      try {
        const formData = new FormData(newsletterForm);

        const res = await fetch(FORM_ENDPOINT, {
          method: "POST",
          body: formData,
          headers: { "Accept": "application/json" }
        });

        if (!res.ok) {
          const out = await res.json().catch(() => ({}));
          const msg = out?.errors?.[0]?.message || "Could not submit. Try again.";
          alert(msg);
          submitBtn.disabled = false;
          submitBtn.textContent = oldText;
          return;
        }

        // ✅ redirect to YOUR thank-you page (note your filename spelling)
        window.location.href = "/newsletter-thanks.html";
      } catch (err) {
        console.error(err);
        alert("Network error. Try again.");
        submitBtn.disabled = false;
        submitBtn.textContent = oldText;
      }
    });

    // Upgrade button -> Stripe checkout via Netlify function
    const upgradeBtn = document.getElementById("upgradeBtn");
    upgradeBtn.addEventListener("click", async () => {
      const old = upgradeBtn.textContent;
      upgradeBtn.disabled = true;
      upgradeBtn.textContent = "Opening checkout…";

      try {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (!session?.user) {
          window.location.href = "/create-account.html";
          return;
        }

        const email = session.user.email;
        const user_id = session.user.id;

        const res = await fetch("/.netlify/functions/create_checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, user_id })
        });

        const out = await res.json().catch(() => ({}));
        if (!res.ok || !out.url) {
          alert(out.error || `Checkout failed (HTTP ${res.status})`);
          return;
        }

        window.location.href = out.url;
      } catch (e) {
        console.error(e);
        alert("Something went wrong starting checkout.");
      } finally {
        upgradeBtn.disabled = false;
        upgradeBtn.textContent = old;
      }
    });
  </script>
</body>
</html>

